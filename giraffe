##get chr1 of graph genome
samtools faidx /mnt/NEOGENE1/projects/refbias_2020/graph_genome/SBG.Graph.B37.V7.dev2.fa 1 > /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.fa

/usr/local/sw/vcftools-0.1.16/bin/vcftools --gzvcf /mnt/NEOGENE1/projects/refbias_2020/graph_genome/SBG.Graph.B37.V7.dev2.vcf.gz --chr 1 --recode --out /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1

# Construct ##didnt use this part
cat > vg_construct.sh <<EOF
#!/bin/bash -l
#SBATCH -p chimp
#SBATCH -n 40
#SBATCH -t 5-00:00:00
#SBATCH -J vg_construct
#SBATCH -o slurm-%j-%N-%u.out
#SBATCH -e slurm-%J-%N-%u.err

/usr/local/sw/vg/bin/vg construct -r/mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.fa -v /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.recode.vcf > /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.vg 
EOF

##prune ##didnt use this part

cat > vg_prune.sh <<EOF
#!/bin/bash -l
#SBATCH -p gorilla
#SBATCH -n 40
#SBATCH -t 5-00:00:00
#SBATCH -J vg_prune
#SBATCH -o slurm-%j-%N-%u.out
#SBATCH -e slurm-%J-%N-%u.err

/usr/local/sw/vg/bin/vg prune /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.vg > /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.pruned.vg
EOF

# Index ##didnt use this part

cat > vg_index.sh <<EOF
#!/bin/bash -l
#SBATCH -p gorilla
#SBATCH -n 80
#SBATCH -t 5-00:00:00
#SBATCH -J vg_index
#SBATCH -o slurm-%j-%N-%u.out
#SBATCH -e slurm-%J-%N-%u.err

/usr/local/sw/vg/bin/vg index -x /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.pruned.xg -g /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.pruned.gcsa /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.pruned.vg
EOF


##############################
#Autoindex
cat > vg_autoindex.sh <<EOF
#!/bin/bash -l
#SBATCH -p chimp
#SBATCH -n 15
#SBATCH -t 5-00:00:00
#SBATCH -J vg_autoindex
#SBATCH -o slurm-%j-%N-%u.out
#SBATCH -e slurm-%J-%N-%u.err

/usr/local/sw/vg/bin/vg autoindex --workflow giraffe -r /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.fa /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.recode.vcf -p /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.pangenome
EOF

#Map

cat > vg_gir5.sh <<EOF
#!/bin/bash -l
#SBATCH -p chimp
#SBATCH -n 20
#SBATCH -t 5-00:00:00
#SBATCH -J vg_map5
#SBATCH -o slurm-%j-%N-%u.out
#SBATCH -e slurm-%J-%N-%u.err

/usr/local/sw/vg/bin/vg giraffe -Z /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.pangenome.giraffe.gbz -m /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.pangenome.min -d /mnt/NEOGENE1/projects/refbias_2020/giraffe/SBG.Graph.B37.V7.dev2.chr1.pangenome.dist -f /mnt/NEOGENE1/projects/refbias_2020/mapping/gargamel/diffcov2/fastq/cov10_sim5.all.fastq.gz -o BAM > /mnt/NEOGENE1/projects/refbias_2020/giraffe/cov10_bams/cov10_sim5.all.gr.bam
EOF

